function logout(){fetch("http://localhost:3000/account/logout").then((e=>{200===e.status?(console.log("Logged out"),window.location.href="index.html"):console.error("Error logging out")})).catch((e=>{console.error("Error:",e)}))}async function fetchUserData(){try{const e=await fetch("http://localhost:3000/account/get-user-data");if(e.ok){const t=await e.json();document.querySelector(".titles h2").innerHTML=`Welcome <strong>${t.display_name}</strong>`,document.getElementById("display_name").innerText=`Display Name: ${t.display_name||""}`,document.getElementById("email").innerText=`Email: ${t.email}`,document.getElementById("name").innerText=`Name: ${t.First_name+" "+t.last_name||""}`,document.getElementById("age").innerText=`Age: ${t.age||""}`,document.getElementById("phone_number").innerText=`Phone Number: ${t.phone_number||""}`,document.querySelector('#edit-form input[name="display_name"]').value=t.display_name||"",document.querySelector('#edit-form input[name="email"]').value=t.email,document.querySelector('#edit-form input[name="first_name"]').value=t.First_name||"",document.querySelector('#edit-form input[name="last_name"]').value=t.last_name||"",document.querySelector('#edit-form input[name="age"]').value=t.age||"",document.querySelector('#edit-form input[name="phone_number"]').value=t.phone_number||""}else console.error("Error fetching user data")}catch(e){console.error("Error:",e)}}async function fetchUserFavoriteGames(){try{const e=await fetch("http://localhost:3000/account/get-favorite-games");e.ok?displayFavoriteGames(await e.json()):console.error("Error fetching user favorite games")}catch(e){console.error("Error:",e)}}function toggleEditForm(){const e=document.getElementById("user-info");var t=document.getElementById("edit-form");const n=document.getElementById("edit-btn");var o=document.getElementById("update-btn");"none"===t.style.display?(e.style.display="none",t.style.display="block",o.style.display="inline-flex",o.removeAttribute("style"),n.textContent="Cancel"):(e.style.display="block",t.style.display="none",o.style.display="none",n.textContent="Edit Profile")}async function addGameToUserFavorites(e,t){const n=document.getElementById("search-text");try{(await fetch("http://localhost:3000/account/add-favorite-game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({game_id:e})})).ok?(n.textContent=`${t} added to your favorite games`,console.log(`Game '${t}' added to user favorites`),fetchUserFavoriteGames()):(n.textContent=`${t} already is in your list of favorite games`,console.error(`Error adding game '${t}' to user favorites`))}catch(e){console.error("Error:",e)}}function createDOMNode(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}async function displayFavoriteGames(e){const t=document.getElementById("release-container");if(t.innerHTML="",e)for(const n of e){const e=await fetchGameData(n);if(e){const n=createDOMNode(createCardTemplate(e,"normal"));t.appendChild(n)}else console.error("Game data is not valid.")}else console.error("No Favorite games found.")}document.getElementById("update-user-form").addEventListener("submit",(async e=>{e.preventDefault();const t=new FormData(e.target),n=Object.fromEntries(t.entries()),o=document.getElementById("user-info");var a=document.getElementById("edit-form");const r=document.getElementById("edit-btn");var s=document.getElementById("update-btn");try{(await fetch("http://localhost:3000/account/update-user-data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok?(alert("User data updated successfully"),fetchUserData(),o.style.display="block",a.style.display="none",s.style.display="none",r.textContent="Edit Profile"):alert("Error updating user data")}catch(e){console.error("Error:",e),alert("Error updating user data")}})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("search-input"),t=document.getElementById("search-text");document.querySelectorAll("#search-results").forEach((e=>{e.addEventListener("click",(async e=>{if(e.target.closest(".card, .mini-card")){const t=e.target.closest(".card, .mini-card").id.trim(),n=e.target.closest(".card, .mini-card").querySelector(".name").textContent.trim();console.log("Clicked: ",n),await addGameToUserFavorites(t,n)}}))})),e.addEventListener("keypress",(e=>{"Enter"===e.key&&(t.textContent="Please select a game to add it to your favorites")}))})),document.addEventListener("DOMContentLoaded",(()=>{fetchUserData(),fetchUserFavoriteGames()}));